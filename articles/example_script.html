<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Basic SerolyzeR functionalities • SerolyzeR</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic SerolyzeR functionalities">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SerolyzeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example_script.html">Basic SerolyzeR functionalities</a></li>
    <li><a class="dropdown-item" href="../articles/multiplate_tutorial.html">Multiplate SerolyzeR functionalities</a></li>
    <li><a class="dropdown-item" href="../articles/our_datasets.html">Our datasets</a></li>
    <li><a class="dropdown-item" href="../articles/our_plots.html">SerolyzeR plots</a></li>
    <li><a class="dropdown-item" href="../articles/our_reports.html">SerolyzeR HTML reports</a></li>
    <li><a class="dropdown-item" href="../articles/parsers.html">Raw data parsers</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mini-pw/SerolyzeR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Basic SerolyzeR functionalities</h1>
                        <h4 data-toc-skip class="author">Tymoteusz
Kwieciński</h4>
            
            <h4 data-toc-skip class="date">2025-07-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mini-pw/SerolyzeR/blob/main/vignettes/example_script.Rmd" class="external-link"><code>vignettes/example_script.Rmd</code></a></small>
      <div class="d-none name"><code>example_script.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="reading-the-plate-object">Reading the plate object<a class="anchor" aria-label="anchor" href="#reading-the-plate-object"></a>
</h2>
<p>The basic functionality of the <code>SerolyzeR</code> package is
reading raw MBA data. To present the package’s functionalities, we use a
sample dataset from the Covid OISE study, which is pre-loaded into the
package. You might want to replace these variables with paths to your
files on your local disk, to test the package on your data.</p>
<p>Firstly, let us load the dataset as the object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mini-pw/SerolyzeR" class="external-link">SerolyzeR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">plate_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"CovidOISExPONTENT.csv"</span>, package <span class="op">=</span> <span class="st">"SerolyzeR"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># get the filepath of the csv dataset</span></span>
<span></span>
<span><span class="va">layout_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"CovidOISExPONTENT_layout.xlsx"</span>, package <span class="op">=</span> <span class="st">"SerolyzeR"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">plate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_luminex_data.html">read_luminex_data</a></span><span class="op">(</span><span class="va">plate_filepath</span>, <span class="va">layout_filepath</span><span class="op">)</span> <span class="co"># read the data</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading Luminex data from: /home/runner/work/_temp/Library/SerolyzeR/extdata/CovidOISExPONTENT.csv</span></span>
<span><span class="co">#&gt; using format xPONENT</span></span></code></pre>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; New plate object has been created with name: CovidOISExPONTENT!</span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span></span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Plate with 96 samples and 30 analytes</span></span></code></pre>
<p>The is an object which encapsulates all the information about the
plate, such as the sample names, analyte names, and the MFI values. For
more details about the object, check the documentation by executing the
command <code><a href="../reference/Plate.html">?Plate</a></code>.</p>
<p>The <code><a href="../reference/read_luminex_data.html">read_luminex_data()</a></code> function used above, reads the
data from the CSV plate file and the layout file and outputs the object.
This method allows also for more advanced options, such as overriding
the information from the files, or setting the data reading options,
e.g. the Luminex file format (<code>xPONENT</code> or
<code>INTELLIFLEX</code>) or the file separators and data encoding. For
more details about the function, we encourage you to explore the
documentation by executing the command
<code><a href="../reference/read_luminex_data.html">?read_luminex_data</a></code>.</p>
<p>It also detects automatically the sample types, using an internal
method [<code><a href="../reference/translate_sample_names_to_sample_types.html">translate_sample_names_to_sample_types()</a></code>]. The
method uses the sample names, sourced either from the layout file or the
CSV plate file, to determine the sample types. The types of samples are
then stored in the <code>sample_types</code> field of the plate object.
The sample types are used to distinguish between the standard curve
samples, control samples and the test samples. The documentation of this
function contains more details about the sample types detection.</p>
</div>
<div class="section level2">
<h2 id="processing-the-whole-plate">Processing the whole plate<a class="anchor" aria-label="anchor" href="#processing-the-whole-plate"></a>
</h2>
<p>Once we have loaded the plate object, we may process it using the
function [<code><a href="../reference/process_plate.html">process_plate()</a></code>]. This function fits a model to
each analyte using the standard curve samples. By default, it computes
RAU values for each analyte using the corresponding model. The computed
RAU values are then saved to a CSV file in a specified folder with the
parameter <code>output_dir</code> in a file with specified name
<code>filename</code>, which by default is based on the plate name and
the normalisation type - this function also allows normalisation for
nMFI values, more details about this method may be found in the
<code>nMFI</code> section of this document, or in documentation of
<code><a href="../reference/get_nmfi.html">?get_nmfi</a></code> function.</p>
<p>This function fits a model to each analyte using the standard curve
samples. By default, it computes Relative Antibody Units (RAU) for each
analyte based on the fitted model. The computed RAU values are saved to
a CSV file in a directory specified by the <code>output_dir</code>
parameter. The output file is named according to the
<code>filename</code> parameter. If no filename is provided, the
function automatically generates one based on the plate name and the
selected normalisation type.</p>
<p>Additionally, this function supports normalisation for normalised
Median Fluorescence Intensity (nMFI) values. More details on this
normalisation approach can be found in the <code>nMFI</code> section of
this document or in the documentation of [<code><a href="../reference/get_nmfi.html">get_nmfi()</a></code>].</p>
<p>To get more information about the function, check
<code><a href="../reference/process_plate.html">?process_plate</a></code>.</p>
<p>Below, we execute the function on the plate object and save the
output to a temporary directory.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span>check <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># create a temporary directory to store the output</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_plate.html">process_plate</a></span><span class="op">(</span><span class="va">plate</span>, output_dir <span class="op">=</span> <span class="va">example_dir</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Fitting the models and predicting RAU for each analyte</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Saving the computed RAU values to a CSV file located in: '/tmp/RtmpyXVcJ4/CovidOISExPONTENT_RAU.csv'</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "Spike_6P"      "ME"            "HKU1_S"        "OC43_NP"      </span></span>
<span><span class="co">#&gt;  [5] "OC43_S"        "HKU1_NP"       "X229E_NP"      "Mumps_NP"     </span></span>
<span><span class="co">#&gt;  [9] "RBD_B16171"    "NL63_NP"       "RBD_B16172"    "RBD_wuhan"    </span></span>
<span><span class="co">#&gt; [13] "NL63_S"        "X229E_S"       "Spike_B16172"  "Spike_B117"   </span></span>
<span><span class="co">#&gt; [17] "Measles_NP"    "Ade5"          "NP"            "Spike_P1"     </span></span>
<span><span class="co">#&gt; [21] "Rub"           "Ade40"         "RBD_B117"      "Spike_B1351"  </span></span>
<span><span class="co">#&gt; [25] "FluA"          "RBD_B1351"     "RBD_P15"       "S2"           </span></span>
<span><span class="co">#&gt; [29] "Spike_omicron" "RBD_omicron"</span></span></code></pre>
<p>We can take a look at a slice of the produced dataframe (as not to
overcrowd the article).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;           Spike_6P           ME       HKU1_S      OC43_NP       OC43_S</span></span>
<span><span class="co">#&gt; B         4.931518 3.704750e-08     6.898885     5.119416     2.375258</span></span>
<span><span class="co">#&gt; 1/50  20000.000000 2.000000e+04 20000.000000 20000.000000 20000.000000</span></span>
<span><span class="co">#&gt; 1/100  9143.434470 8.254827e+03  8235.114494  8343.787523  8326.658518</span></span>
<span><span class="co">#&gt; 1/200  5907.196193 5.394031e+03  5200.885095  5169.162138  5240.371360</span></span>
<span><span class="co">#&gt; 1/400  2485.577756 2.537018e+03  2603.062419  2626.436864  2556.577252</span></span></code></pre>
<p>To automate the processing the plates, we can also use
[<code>process_file</code>] and [<code>process_dir</code>] methods. The
former processes a single file, while the latter processes all the files
in a directory.</p>
<p>[<code>process_file</code>] parses the plate file and saves the
normalised output files to the specified directory. An example execution
of the function is shown below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/process_file.html">process_file</a></span><span class="op">(</span><span class="va">plate_filepath</span>, <span class="va">layout_filepath</span>, output_dir <span class="op">=</span> <span class="va">example_dir</span>, generate_report <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading Luminex data from: /home/runner/work/_temp/Library/SerolyzeR/extdata/CovidOISExPONTENT.csv</span></span>
<span><span class="co">#&gt; using format xPONENT</span></span></code></pre>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; New plate object has been created with name: CovidOISExPONTENT!</span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span></span></span>
<span><span class="co">#&gt; Processing plate 'CovidOISExPONTENT'</span></span>
<span><span class="co">#&gt; Extracting the raw MFI to the output dataframe</span></span>
<span><span class="co">#&gt; Saving the computed MFI values to a CSV file located in: '/tmp/RtmpyXVcJ4/CovidOISExPONTENT_MFI.csv'</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Fitting the models and predicting RAU for each analyte</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Saving the computed RAU values to a CSV file located in: '/tmp/RtmpyXVcJ4/CovidOISExPONTENT_RAU.csv'</span></span>
<span><span class="co">#&gt; Computing nMFI values for each analyte</span></span>
<span><span class="co">#&gt; Saving the computed nMFI values to a CSV file located in: '/tmp/RtmpyXVcJ4/CovidOISExPONTENT_nMFI.csv'</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Plate with 96 samples and 30 analytes</span></span></code></pre>
<p>It saves <code>RAU</code> and <code>nMFI</code> values to the
<code>output_dir</code>, working similarly to the
[<code><a href="../reference/process_plate.html">process_plate()</a></code>] function. Additionally it has an option
to produce a single plate report, which can be enabled with
<code>generate_report = TRUE</code> parameter. The report is saved in
the same directory as the output files, with the name based on the plate
name. For more detailed description of the reports, we refer to the
.</p>
<p>[<code><a href="../reference/process_dir.html">process_dir()</a></code>] processes all the files in the specified
directory. The description of this method can be found in the separate
.</p>
</div>
<div class="section level2">
<h2 id="quality-control-and-normalisation-details">Quality control and normalisation details<a class="anchor" aria-label="anchor" href="#quality-control-and-normalisation-details"></a>
</h2>
<p>Apart from the <code><a href="../reference/process_plate.html">process_plate()</a></code> function, the package
provides a set of methods allowing for more detailed and advanced
quality control and normalisation of the data.</p>
<div class="section level3">
<h3 id="plate-summary-and-details">Plate summary and details<a class="anchor" aria-label="anchor" href="#plate-summary-and-details"></a>
</h3>
<p>After the plate is successfully loaded, we can look at some basic
information about it.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Summary of the plate with name 'CovidOISExPONTENT':</span></span>
<span><span class="co">#&gt; Plate examination date: 2022-05-12 18:17:40</span></span>
<span><span class="co">#&gt; Total number of samples: 96</span></span>
<span><span class="co">#&gt; Number of blank samples: 1</span></span>
<span><span class="co">#&gt; Number of standard curve samples: 11</span></span>
<span><span class="co">#&gt; Number of positive control samples: 0</span></span>
<span><span class="co">#&gt; Number of negative control samples: 0</span></span>
<span><span class="co">#&gt; Number of test samples: 84</span></span>
<span><span class="co">#&gt; Number of analytes: 30</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span>include_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># more detailed summary</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Summary of the plate with name 'CovidOISExPONTENT':</span></span>
<span><span class="co">#&gt; Plate examination date: 2022-05-12 18:17:40</span></span>
<span><span class="co">#&gt; Total number of samples: 96</span></span>
<span><span class="co">#&gt; Number of blank samples: 1</span></span>
<span><span class="co">#&gt; Number of standard curve samples: 11</span></span>
<span><span class="co">#&gt; Sample names: '1/50', '1/100', '1/200', '1/400', '1/800', '1/1600', '1/3200', '1/6400', '1/12800', '1/25600', '1/102400'</span></span>
<span><span class="co">#&gt; Number of positive control samples: 0</span></span>
<span><span class="co">#&gt; Number of negative control samples: 0</span></span>
<span><span class="co">#&gt; Number of test samples: 84</span></span>
<span><span class="co">#&gt; Number of analytes: 30</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="va">sample_names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="co"># print some of the sample names</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "B"     "1/50"  "1/100" "1/200" "1/400"</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="va">analyte_names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="co"># print some of the analyte names</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "Spike_6P" "ME"       "HKU1_S"   "OC43_NP"</span></span></code></pre>
<p>The summary can also be accessed using the built-in generic method
<code>summary.Plate()</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Summary of the plate with name 'CovidOISExPONTENT':</span></span>
<span><span class="co">#&gt; Plate examination date: 2022-05-12 18:17:40</span></span>
<span><span class="co">#&gt; Total number of samples: 96</span></span>
<span><span class="co">#&gt; Number of blank samples: 1</span></span>
<span><span class="co">#&gt; Number of standard curve samples: 11</span></span>
<span><span class="co">#&gt; Number of positive control samples: 0</span></span>
<span><span class="co">#&gt; Number of negative control samples: 0</span></span>
<span><span class="co">#&gt; Number of test samples: 84</span></span>
<span><span class="co">#&gt; Number of analytes: 30</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="quality-control">Quality control<a class="anchor" aria-label="anchor" href="#quality-control"></a>
</h3>
<p>The package can plot the RAU along the MFI values, allowing manual
inspection of the standard curve.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"OC43_S"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-7-1.png" width="70%"></p>
<p>We can also plot the standard curve for different analytes and data
types. A list of all available analytes on the plate can be accessed
using the command <code>plate$analyte_names</code>.</p>
<p>By default, all the operations are performed on the
<code>Median</code> value of the samples; this option can be selected
from the <code>data_type</code> parameter of the function.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"RBD_wuhan"</span>, data_type <span class="op">=</span> <span class="st">"Mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-8-1.png" width="70%"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"RBD_wuhan"</span>, data_type <span class="op">=</span> <span class="st">"Avg Net MFI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-8-2.png" width="70%"></p>
<p>This plot may be used to assess the standard curve’s quality and
anticipate some potential issues with the data. For instance, if we
plotted the standard curve for the analyte, <code>ME</code>, we could
notice that the <code>Median</code> value of the sample with RAU of
<code>39.06</code> is abnormally large, which may indicate a problem
with the data.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"ME"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-9-1.png" width="70%"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte.html">plot_standard_curve_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"ME"</span>, log_scale <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-9-2.png" width="70%"></p>
<p>The plotting function has more options, such as selecting which axis
the log scale should be applied or reversing the curve. More detailed
information can be found in the function documentation, accessed by
executing the command <code><a href="../reference/plot_standard_curve_analyte.html">?plot_standard_curve_analyte</a></code>.</p>
<p>Another valuable method of inspecting the potential errors of the
data is <code><a href="../reference/plot_mfi_for_analyte.html">plot_mfi_for_analyte()</a></code>. This method plots the MFI
values of standard curve samples for a given analyte along the boxplot
of the MFI values of the test samples.</p>
<p>It helps identify the outlier samples and check if the test samples
are within the range of the standard curve samples.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mfi_for_analyte.html">plot_mfi_for_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"OC43_S"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-10-1.png" width="70%"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_mfi_for_analyte.html">plot_mfi_for_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"Spike_6P"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-10-2.png" width="70%"></p>
<p>For the <code>Spike_6P</code> analyte, the MFI values don’t fall
within the range of the standard curve samples, which could be
problematic for the model. The test RAU values will be extrapolated (up
to a point) from the standard curve, which may lead to incorrect
results.</p>
<p>The package allows also a straightforward way to adjust the MFI
values using the background samples. To do so, we can use the
<code>plate$blank_adjustment</code> method, as below:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="va">blank_adjusted</span> <span class="co"># verify if the data is already adjusted</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate</span><span class="op">$</span><span class="fu">blank_adjustment</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Plate with 96 samples and 30 analytes</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="normalisation">Normalisation<a class="anchor" aria-label="anchor" href="#normalisation"></a>
</h3>
<p>After inspection, we may create the model for the standard curve of a
specific antibody. The model is fitted using the <code>nplr</code>
package, which provides a simple interface for fitting n-parameter
logistic regression models. Still, to create a more straightforward
interface for the user, we encapsulated this model into our own class
called <code>Model</code> for simplicity. The detailed documentation of
the class can be found by executing the command <code><a href="../reference/Model.html">?Model</a></code>.</p>
<p>The model is then used to predict the RAU values of the samples based
on the MFI values.</p>
<div class="section level4">
<h4 id="rau-vs-dilution">RAU vs dilution<a class="anchor" aria-label="anchor" href="#rau-vs-dilution"></a>
</h4>
<p>To distinguish between actual dilution values (the ones known for the
standard curve samples) from the dilution predictions (obtained using
the fitted standard curve), we introduced into our package a unit called
RAU (Relative Antibody Unit) which is equal to the dilution
<strong>prediction</strong> multiplied by a <span class="math inline">\(1,000,000\)</span> to provide a more readable
value.</p>
</div>
<div class="section level4">
<h4 id="inner-nplr-model">Inner nplr model<a class="anchor" aria-label="anchor" href="#inner-nplr-model"></a>
</h4>
<p><code>nplr</code> package fits the model using the formula:</p>
<p><span class="math display">\[ y = B + \frac{T - B}{[1 + 10^{b \cdot
(x_{mid} - x)}]^s},\]</span> where:</p>
<ul>
<li><p><span class="math inline">\(y\)</span> is the predicted value,
MFI in our case,</p></li>
<li><p><span class="math inline">\(x\)</span> is the independent
variable, dilution of the standard curve samples in our case,</p></li>
<li><p><span class="math inline">\(B\)</span> is the bottom plateau -
the right horizontal asymptote,</p></li>
<li><p><span class="math inline">\(T\)</span> is the top plateau - the
left horizontal asymptote,</p></li>
<li><p><span class="math inline">\(b\)</span> is the slope of the curve
at the inflection point,</p></li>
<li><p><span class="math inline">\(x_{mid}\)</span> is x-coordinate at
the inflection point,</p></li>
<li><p><span class="math inline">\(s\)</span> is the asymmetric
coefficient.</p></li>
</ul>
<p>This equation is referred to as the Richards’ equation. More
information about the model can be found in the <code>nplr</code>
package documentation.</p>
</div>
<div class="section level4">
<h4 id="predicting-rau">Predicting RAU<a class="anchor" aria-label="anchor" href="#predicting-rau"></a>
</h4>
<p>By reversing that logistic function, we can predict the dilution of
the samples based on the MFI values. The RAU value is then the predicted
dilution of the sample multiplied by <span class="math inline">\(1,000,000\)</span>.</p>
<p>To limit the extrapolation error from above (values above maximum RAU
value for the standard curve samples), we clip all predictions above to
<span class="math inline">\(M\)</span> where
<code>over_max_extrapolation</code> is user controlled parameter to the
<code><a href="../reference/predict.Model.html">predict.Model()</a></code> function. By default
<code>over_max_extrapolation</code> is set to <span class="math inline">\(0\)</span>.</p>
<blockquote>
<p>Warning: High dose hook effect affects the prediction truncation
(clipping).</p>
</blockquote>
<p>When a high dose hook effect is detected we exclude from standard
curve calculations the samples that have dilutions higher or equal to
1/200. This will cause a truncation of values to the next greatest
dilution multiplied by <span class="math inline">\(1,000,000\)</span>.</p>
</div>
<div class="section level4">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h4>
<p>By default, the <code>nplr</code> model transforms the x values using
the log10 function. To create a model for a specific analyte, we use the
<code>create_standard_curve_model_analyte</code> function, which fits
and returns the model for the analyte.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_standard_curve_model_analyte.html">create_standard_curve_model_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"OC43_S"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Instance of the Model class fitted for analyte ' OC43_S ': </span></span>
<span><span class="co">#&gt;  - fitted with 5 parameters</span></span>
<span><span class="co">#&gt;  - using 11 samples</span></span>
<span><span class="co">#&gt;  - using log residuals (mfi):  TRUE </span></span>
<span><span class="co">#&gt;  - using log dilution:  TRUE </span></span>
<span><span class="co">#&gt;  - top asymptote: 28414.96 </span></span>
<span><span class="co">#&gt;  - bottom asymptote: 38.60885 </span></span>
<span><span class="co">#&gt;  - goodness of fit: 0.9970645 </span></span>
<span><span class="co">#&gt;  - weighted goodness of fit: 0.9998947</span></span></code></pre>
<p>Since our <code>model</code> object contains all the characteristics
and parameters of the fitted regression model. The model can be used to
predict the RAU values of the samples based on the MFI values. The
output above shows the most critical parameters of the fitted model.</p>
<p>The predicted values may be used to plot the standard curve, which
can be compared to the sample values.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-14-1.png" width="70%"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span>, plot_asymptote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-14-2.png" width="70%"></p>
<p>As we can see below, when predicting RAU for analytes for which we
observed the high dose hook effect, the truncation level changes to a
RAU value corresponding to a first sample with dilution below 1/200
(1/400 in this case, RAU = 2500).</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_hdh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_standard_curve_model_analyte.html">create_standard_curve_model_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"RBD_omicron"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model_hdh</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-15-1.png" width="70%"></p>
<p>Apart from the plotting, the package can predict the values of all
the samples on the plate.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfi_values</span> <span class="op">&lt;-</span> <span class="va">plate</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">Median</span><span class="op">$</span><span class="va">OC43_S</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mfi_values</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1]   43.0 4193.0 1982.0 1308.0  681.0  365.5</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted_rau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">mfi_values</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">predicted_rau</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;            RAU    MFI</span></span>
<span><span class="co">#&gt; 1     2.375258   43.0</span></span>
<span><span class="co">#&gt; 2 20000.000000 4193.0</span></span>
<span><span class="co">#&gt; 3  8326.658518 1982.0</span></span>
<span><span class="co">#&gt; 4  5240.371360 1308.0</span></span>
<span><span class="co">#&gt; 5  2556.577252  681.0</span></span>
<span><span class="co">#&gt; 6  1242.668884  365.5</span></span></code></pre>
<p>The dataframe contains original MFI values and the predicted RAU
values based on the model.</p>
<p>In order to allow extrapolation from above (up to a certain value) we
can set <code>over_max_extrapolation</code> to a positive value. To
illustrate that we can look at prediction plots. The
<code><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model()</a></code> takes any
additional parameters and passes them to a <code>predict</code> method
so we can visually see the effect of the
<code>over_max_extrapolation</code> parameter.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_standard_curve_model_analyte.html">create_standard_curve_model_analyte</a></span><span class="op">(</span><span class="va">plate</span>, analyte_name <span class="op">=</span> <span class="st">"Spike_6P"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-17-1.png" width="70%"></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_standard_curve_analyte_with_model.html">plot_standard_curve_analyte_with_model</a></span><span class="op">(</span><span class="va">plate</span>, <span class="va">model</span>, log_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span><span class="op">)</span>, over_max_extrapolation <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_script_files/figure-html/unnamed-chunk-18-1.png" width="70%"></p>
</div>
</div>
<div class="section level3">
<h3 id="nmfi">nMFI<a class="anchor" aria-label="anchor" href="#nmfi"></a>
</h3>
<p>In some cases, the RAU values cannot be reliably calculated. This may
happen when the MFI values of test samples are way higher than those of
the standard curve samples. In that case, to avoid extrapolation but to
be still able to compare the samples across the plates, we introduced a
new unit called nMFI (Normalized MFI). The nMFI is calculated as the MFI
value of the test sample divided by the MFI value of the standard curve
sample with the selected dilution value.</p>
<p>nMFI values of the samples can be calculated in two ways - using the
<code><a href="../reference/get_nmfi.html">get_nmfi()</a></code> function or with the
<code><a href="../reference/process_plate.html">process_plate()</a></code> function that also saves the output into
the CSV file by setting the <code>normalisation_type</code> parameter to
<code>nMFI</code> in the <code><a href="../reference/process_plate.html">process_plate()</a></code> function. By
default the output will be saved as a file with the same name as the
plate name but with the <code>_nMFI</code> suffix.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmfi_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_nmfi.html">get_nmfi</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># process plate with nMFI normalisation</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_plate.html">process_plate</a></span><span class="op">(</span><span class="va">plate</span>, output_dir <span class="op">=</span> <span class="va">example_dir</span>, normalisation_type <span class="op">=</span> <span class="st">"nMFI"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Computing nMFI values for each analyte</span></span>
<span><span class="co">#&gt; Saving the computed nMFI values to a CSV file located in: '/tmp/RtmpyXVcJ4/CovidOISExPONTENT_nMFI.csv'</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;          Spike_6P        ME     HKU1_S    OC43_NP     OC43_S</span></span>
<span><span class="co">#&gt; B     0.006735897 0.1466667 0.03318584 0.03409836 0.06314244</span></span>
<span><span class="co">#&gt; 1/50  4.001122649 5.6133333 5.61172566 6.11081967 6.15712188</span></span>
<span><span class="co">#&gt; 1/100 2.436289644 2.7000000 2.72953540 2.79934426 2.91042584</span></span>
<span><span class="co">#&gt; 1/200 1.824586023 1.8777778 1.83849558 1.82557377 1.92070485</span></span>
<span><span class="co">#&gt; 1/400 1.000000000 1.0000000 1.00000000 1.00000000 1.00000000</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tymoteusz Kwiecinski, Jakub Grzywaczewski, Mateusz Nizwantowski.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
